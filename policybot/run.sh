#!/bin/bash

export GCP_CREDS='ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiaXN0aW8tdGVzdGluZyIsCiAgInByaXZhdGVfa2V5X2lkIjogImUyMmI0OGY1MDgxMzA5OTNmODA1NzExMjA5NjJiZjcyNjc5N2Y0ZDkiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQzNERi9ENEVQSWkwMmdcbkdiZGd0d3MrVjBOM3JLTGRNVGRHdWVlbmFGWmJhVzQ2YUt1bFdmbEJIYkhKSzhsL2JVclJNb1pEZnJvKzVHQkhcbmMyd0RHL3JQVlF0eTFWS0ViR2xiQ0JwL1JLTG1KYzJ3TDJaM2xzc2FnM3NYb3FKd2Q2SGZXZVBCNW5yNG56S1hcbjcrMCtMNHZJYkxqS3d1cStXYms2RU1IN0hQZ3JMamNCTmIzSnhQOHEyOEpzNHJuL1RPUEswMXhDa3lrQlo5OFJcbk5xQlVZYTlWMm5JSXN6UjFhQmZCUGdOYnh3NGZzQkRNb3phZi84ZnBXT0JZVmk2M1Zrc1V0dFdtVEVuOTRVTGJcbk1oK1B2UmNSSkNPRXl2T2l3a09HREpHYmlKcGdOM21qaHRIQWlEZm5XUVo5ZmhLa25pb2NqMC9CL1ROZFJyd2hcbnhSOE1McVFoQWdNQkFBRUNnZ0VBRS91ZlZzQmNWZi9USlJlNW02N1A1T25jM1NzMUNtV3RqYVNNNUFzeFprQlBcbnZzT2ZmV2tobTFpMUNHdWx6eW5zd1lLOUFwQktuOFFKdUxNaWh3SmVjcFRycjRrWFBZcWlROFJTTkRPWGZ2MkFcbmcydmhTVXZtZDBvRVBaUE5ITzhLZGxvWFVac3FNSXNjbUZhaWRTZjJvQll5WkR3OEtUU2RVbmZ5M1VtUDFCTERcbktxc0wzRVJUelliTW0zUWliWXRzU2M1SGxZcm80MWE3TWp1OEVPQUd1UjdpcWZLb2tyWE5iYWRrNlB3UG9YejdcbkVoNFlWbUI0R3M2cWE3QUlySENNUDR1S0ZCOE5yMHJUWkZLNnh5YVU3a1VkV2V3UkRRM29JZHVSQTJkb2NaY3lcbmJVZHhtem5xazFpZGkzUE5aR1RDekJwa1BPKzF5bXNJaVhFOGd0aGthd0tCZ1FEOCtJdHJrVG5nd2w4K1VNSmdcbnEwRXQ3ZkE0dzlRMGdYVWVudzQwM3FJRnpicDlqckN5UHcvSk0vYjBiZXBxYjlGbVErRDdycDVGUnpCdTlUOVFcbmgvcHEranNVQ3dtY1l6MVVXejhLRTFJaGJ2OTFzVFVhMUd2aER5QitaQldFbGVNR052QndiTEhzYmpGbXdIVm1cbkIwRDMvZEhVZGJrN0xBY3VVeklTL2l6NnZ3S0JnUUM1UFgxRlljWnNwbWNtVEpXQW5EUnZtT3JqcXIxZGdwZUJcbjJOOGxaVUFCOFdpVTVFNDlaQlFROUl6Q1BFZElWYWtDYVJZRHdDdU5XNmlORWNidnhjdUdnTGdpS0ZmSFE5bjlcbnZNcThpWHV2UFB5aWpkQmkvWklkanJXNk1WNldjWVBGZ2hqS1pQQ2VqSVlTMkh2aEFveVU3NkIzNTZHalJ5S1NcbmgrNTlJOGg1SHdLQmdHRStoaEhXcE9JaXRndzFiVk5ONGVOdkNSNDVJVlVCd3V6L2hhMkxPOHR4VjFRMnl2UHFcblMvNHpiS1p2cm1JMkU4LzFIZ0tDRUxOZTkxNWdCblBGb2QwSHpqZ1pPaHVWQnBscjdpTElaSlVYbnpvMTRjMHJcbmhVRGgyTUxkWkd3d1ZqSW9ZbXRGVFd3dXUremM1UVJRbTRmNVdYVUx3Q1hmK2U2ejZwYmtnSlB2QW9HQU0zekxcbjNRVVlTZ3JXa09hb2gxN2psRUZFeUpNa24yRTFDM3BrUzlpZ3VlbUgwQnJGUkhzVXVNSEFmaHlURTUvN29oZmpcbmJwZHpnNDcrZ25kMmZCN1dPMFI3NmNLYzQxNFFzVjVRVzZjN0liSXA1bVRVank4Nzljczg1OHZoSnAvV3FJZElcbnJManh5Si8yaERaMytFcmxHR0Npa2JGb1ZDSHBraUVHUVBJNVByRUNnWUVBdGFpRHNRbitWTkt3RDdTenE3a1RcbkRJcnV5cjJRMnlrNk9JQVphQWhEQmhYUG45bmY4UktocnNIWjV6eUI2d0cvUGpXaEd1VllzVHkvOThIVlVaN2dcbjRHV2xvbkNkcEpOZzVjT0JBV1NBQkEwVkRnNERwUy9LbWtBZ3NRVXNCamJDSklqUlp5N0VLL2NJVFFSSXp6WUFcbjJyWXdPM2RKcElsZlZUR0xyRzYzekVFPVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImlzdGlvLXBvbGljeS1ib3RAaXN0aW8tdGVzdGluZy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTc1NjIzODEzMjU2NTYwNDYzNjEiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2lzdGlvLXBvbGljeS1ib3QlNDBpc3Rpby10ZXN0aW5nLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg=='
export GITHUB_CREDS='26c9e378607a072912ba56b825c7c0c8bd9163eb'

# Webhook token
# Seems wrong, but never mind for now.
export GITHUB_SECRET='HotTomale32!'
export SENDGRID_APIKEY='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'

function fail_with_msg() {
  echo $1
  exit 1
}

go build ||  fail_with_msg "failed to build..."
./policybot server --configFile ./policybot.yaml --github_webhook_secret=${GITHUB_SECRET} \
  --github_token=${GITHUB_CREDS}
